<h1>Créer une nouvelle demande</h1>
<%= simple_form_for @request, url: customer_requests_path, method: "POST" do |f| %>
  <%= f.error_notification %>

  <%= f.input :description %>
  <%= f.input :departure,label: "Adresse de départ", input_html: {id: "departure_address"} %>
  <%= f.input :arrival, label: "Adresse d'arrivée", input_html: {id: "arrival_address"} %>
  <!-- Pauline : pour une disposition inline, ajoute une classe input_html: {class: "name"} -->
  <%= f.input :parcel, label: "Type de colis", collection: 0..2, as: :radio_buttons %>
  <!-- Eric -->

  <%= f.button :submit, "Valider la demande" %>
<% end %>
<div class="container">
  <div class="row">
    <div class="col-xs-6 col-lg-12">
      <div id="map" style='width: 100%; height: 600px;'></div>
    </div>
  </div>
</div>


<%= content_for(:after_js) do %>
  <script type="text/javascript">
  $(document).on('ready', function() {

    var geocoder;
    var map;
    var directionsService = new google.maps.DirectionsService();
    var directionsDisplay = new google.maps.DirectionsRenderer();
    var dep_address;
    var arr_address;

    function initialize() {
      var departure_input = document.getElementById('departure_address');
      var arrival_input = document.getElementById('arrival_address');
      var autocomplete = new google.maps.places.Autocomplete(departure_input);
      var autocomplete = new google.maps.places.Autocomplete(arrival_input);

    }
    google.maps.event.addDomListener(window, 'load', initialize);

    function calcRoute(departure, arrival) {
      var origin      = String(departure);
      var destination = String(arrival);
      var request = {
          origin:      origin,
          destination: destination,
          travelMode:  google.maps.TravelMode.DRIVING
      };
      directionsService.route(request, function(response, status) {
        if (status == google.maps.DirectionsStatus.OK) {
          directionsDisplay.setDirections(response);
        }
      });
    }

    // alternative event function for map display
    function testAddressFields() {
      var from = $("#departure_address").val();
      var to = $("#arrival_address").val();
      if ( from && to ) {
        calcRoute( from, to );
        var handler = Gmaps.build('Google');
        handler.buildMap({ internal: { id: 'map' } }, function(){
          directionsDisplay.setMap(handler.getMap());
        });
      };
    };

    $("#arrival_address").change(function() {
      testAddressFields();
      });

    $("#departure_address").change(function() {
      testAddressFields();
      });

    //when quit arrival_address input
    // $("#arrival_address").blur(function() {
    //   calcRoute($("#departure_address").val(),$(this).val());
    //   var handler = Gmaps.build('Google');
    //   handler.buildMap({ internal: { id: 'map' } }, function(){
    //     directionsDisplay.setMap(handler.getMap());
    //   });
    // });

  });

  </script>
<% end %>
